<div class="container">
    <div class="jumbotron">
        <h1>NYTimes Article Scraper</h1>
        {{#if user}}
        <p id="user" username={{user.username}}>Hello {{user.username}}</p>
        <a href="/logout">Logout</a>
        {{else}}
        <a href="/login">Login</a>
        {{/if}}
    </div>








    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Articles</h4>
            </div>
            <div id="articles" class="panel-body">
                {{#each articles}}
                <div class="article">
                    <h3 data-id={{_id}}>{{title}}</h3>
                    <p>{{summary}}</p>
                    <a href={{link}}>Read this article</a>
                </div>
                {{/each}}
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Notes</h4>

            </div>
            <div id="comments" class="panel-body">
                {{#if user}}
                {{else}}
                <form action="/login" method="post">
                    <div>
                        <label>Username:</label>
                        <input type="text" name="username" />
                        <br/>
                    </div>
                    <div>
                        <label>Password:</label>
                        <input type="password" name="password" />
                    </div>
                    <div>
                        <input type="submit" value="Submit"  />
                    </div>
                </form>
                {{/if}}

            </div>
        </div>
    </div>



    <script>

        function getComments() {
            $.get(`/articles/${$(this).attr("data-id")}`)
                .then(function (dbComments) {
                    $("#comments").empty();
                    dbComments.comments.map(function (comment) {
                        $("#comments")
                            .append(
                            $("<div>")
                                .addClass("comment")
                                .append(
                                $("<h4>").text(comment.author),
                                $("<p>").text(comment.body)
                                )
                            );
                    });
                   
                    $("#comments")
                        .append(
                        $("<textarea id='commentBody'></textarea>"),
                        $("<br>"),
                        $(`<button id='addComment' data-id=${dbComments._id}>Add Comment</button>`)
                        );

                });
        }
        function saveComment() {
            //$.ajax(`/articles/${$(this).attr("data-id")}`,
            $.ajax("/articles/" + $(this).attr("data-id"),
                {
                    method: "POST",
                    data: {
                       
                        body: $("#commentBody").val().trim(),
                    },
                })
                .then(function (data) {
                    console.log(data);
                    $("#commentBody").val("");

                });
        }

        $("#articles").on("click", "h3", getComments);
        $("#comments").on("click", "#addComment", saveComment);

        $("#submitOrder").on("click", function () {
            var newBurger = {
                name: $("#orderName").val().trim(),
            };
            $.ajax("/api/burgers", {
                method: "post",
                data: newBurger,
            }).then(function () {
                location.reload();
            });
        });

        $(".devour-button").on("click", function () {
            $.ajax(`/api/burgers/${$(this).attr("data-id")}`, {
                method: "PUT",
            }).then(function () {
                location.reload();
            })
        });
    </script>